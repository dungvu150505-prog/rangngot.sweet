<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Gá»­i lá»i chÃºc - RÄƒng Ngá»t</title>
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
</head>

<body>
  <!-- ğŸ° Logo + slogan -->
  <img src="https://file.garden/aO0lFjCQS03opF7T/st.PNG" alt="Logo RangNgot" class="logo">
  <div class="slogan">From RangNgot with Love ğŸ’</div>

  <!-- ğŸ€ Thiá»‡p chÃ­nh -->
  <div class="card">
    <h1>Gá»­i chÃºt ngá»t ngÃ o Ä‘áº¿n ngÆ°á»i báº¡n thÆ°Æ¡ng ğŸ’Œ</h1>
    <p>HÃ£y nÃ³i lá»i yÃªu thÆ°Æ¡ng cá»§a báº¡n, chÃºng mÃ¬nh sáº½ gÃ³i láº¡i tháº­t xinh vÃ  gá»­i tá»›i ngÆ°á»i Ä‘áº·c biá»‡t dá»‹p 20/10 ğŸ’–</p>

    <input type="file" id="audioFile" accept="audio/*" hidden />
    <button id="uploadBtn" class="play">ğŸ° Gá»­i lá»i chÃºc ngay</button>

    <div id="result" class="result-box" style="display:none;">
      <p>âœ¨ Link ngÆ°á»i nháº­n cá»§a báº¡n:</p>
      <a id="receiverLink" target="_blank"></a>
      <div id="qrCanvas"></div>
    </div>
  </div>

  <script>
    const API_BASE = window.API_BASE || '';
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('audioFile');
    const resultBox = document.getElementById('result');
    const receiverLink = document.getElementById('receiverLink');
    const qrCanvas = document.getElementById('qrCanvas');

    uploadBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', async () => {
      if (!fileInput.files.length) return;
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Äang gá»­i yÃªu thÆ°Æ¡ng...';

      const formData = new FormData();
      formData.append('audio', fileInput.files[0]);

      try {
        const response = await fetch(`${API_BASE}/upload`, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.success) {
          const fullURL = data.absoluteReceiverUrl || `${window.location.origin}${data.receiverUrl}`;
          receiverLink.textContent = fullURL;
          receiverLink.href = fullURL;

          qrCanvas.innerHTML = '';
          new QRCode(qrCanvas, { text: fullURL, width: 120, height: 120, colorDark: '#e2528e', colorLight: '#fff7fa' });
          resultBox.style.display = 'block';
        } else {
          alert(data.message || 'Lá»—i khi táº£i file.');
        }
      } catch (err) {
        console.error(err);
        alert('ÄÃ£ xáº£y ra lá»—i khi káº¿t ná»‘i mÃ¡y chá»§.');
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'ğŸ° Gá»­i lá»i chÃºc ngay';
      }
    });

    // ğŸ’— Tim bay ngáº«u nhiÃªn
    setInterval(() => {
      const heart = document.createElement('div');
      heart.classList.add('heart');
      heart.style.left = Math.random() * 100 + 'vw';
      heart.style.animationDuration = (3 + Math.random() * 3) + 's';
      heart.style.backgroundColor = `hsl(${340 + Math.random() * 20}, 90%, 75%)`;
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 6000);
    }, 800);
  </script>
</body>
</html>
